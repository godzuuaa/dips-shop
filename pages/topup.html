<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô - Dips Hub</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.7.32/sweetalert2.all.min.js"></script>

    <style>
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a0f;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .loading-screen.hide {
            opacity: 0;
            visibility: hidden;
        }
        .infinity-loader {
            width: 80px;
            height: 50px;
        }
        .infinity-loader svg {
            width: 100%;
            height: 100%;
        }
        .infinity-loader path {
            fill: none;
            stroke: #ffffff;
            stroke-width: 4;
            stroke-linecap: round;
            stroke-dasharray: 200;
            stroke-dashoffset: 200;
            animation: drawInfinity 2s ease-in-out infinite;
        }
        @keyframes drawInfinity {
            0% { stroke-dashoffset: 200; }
            50% { stroke-dashoffset: 0; }
            100% { stroke-dashoffset: -200; }
        }
        .loading-logo {
            margin-top: 20px;
            font-size: 1.5rem;
            font-weight: 800;
            font-style: italic;
        }
        .loading-logo .dips { color: white; }
        .loading-logo .hub { color: #14b8a6; }
        .loading-progress {
            width: 200px;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 30px;
            overflow: hidden;
        }
        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #14b8a6, #5eead4);
            width: 0%;
            animation: loadProgress 1.5s ease-in-out forwards;
        }
        @keyframes loadProgress {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Kanit', sans-serif;
        }

        body {
            background-color: #0d1117;
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Background */
        .bg-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .bg-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('../images/24678.jpg');
            background-size: cover;
            background-position: center;
        }

        .bg-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        /* Navbar */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(2px);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .nav-brand span {
            font-size: 1.3rem;
            font-weight: 800;
            font-style: italic;
        }

        .nav-brand .dips {
            color: white;
        }

        .nav-brand .hub {
            color: #14b8a6;
        }

        .nav-links {
            display: flex;
            gap: 25px;
        }

        .nav-links a {
            color: #b0b0b0;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s;
        }

        .nav-links a:hover, .nav-links a.active {
            color: #5eead4;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        /* Main Content */
        .main-content {
            min-height: 100vh;
            padding-top: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .topup-container {
            max-width: 900px;
            width: 100%;
            padding: 40px;
        }

        /* Page Title */
        .page-title {
            text-align: center;
            margin-bottom: 50px;
        }

        .page-title h1 {
            font-size: 2.8rem;
            font-weight: 700;
            text-shadow: 0 0 30px rgba(20, 184, 166, 0.3);
        }

        .page-title .white { color: white; }
        .page-title .red { 
            color: #14b8a6;
            background: linear-gradient(135deg, #14b8a6, #5eead4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Payment Options */
        .payment-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 40px;
        }

        .payment-option {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 25px 30px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .payment-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(20, 184, 166, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .payment-option:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(20, 184, 166, 0.5);
            box-shadow: 0 20px 50px rgba(20, 184, 166, 0.25),
                        0 0 0 1px rgba(20, 184, 166, 0.1);
        }

        .payment-option:hover::before {
            opacity: 1;
        }

        .payment-option.selected {
            border-color: #14b8a6;
            background: rgba(20, 184, 166, 0.15);
            box-shadow: 0 0 30px rgba(20, 184, 166, 0.3),
                        inset 0 0 20px rgba(20, 184, 166, 0.1);
        }

        .payment-option.selected::after {
            content: '‚úì';
            position: absolute;
            top: 15px;
            right: 15px;
            width: 24px;
            height: 24px;
            background: #14b8a6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
            animation: checkPop 0.3s ease;
        }

        @keyframes checkPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .payment-icon {
            width: 65px;
            height: 65px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            position: relative;
            z-index: 1;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s;
        }

        .payment-option:hover .payment-icon {
            transform: scale(1.1) rotate(-5deg);
        }

        .payment-icon.angpao {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        }

        .payment-icon.qr {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .payment-icon.coupon {
            background: linear-gradient(135deg, #a55eea, #8854d0);
        }

        .payment-info {
            position: relative;
            z-index: 1;
        }

        .payment-info h3 {
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            transition: color 0.3s;
        }

        .payment-option:hover .payment-info h3 {
            color: #5eead4;
        }

        .payment-info p {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* Custom Checkbox */
        .terms-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 30px;
            padding: 15px 25px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .checkbox-custom {
            position: relative;
            width: 22px;
            height: 22px;
        }

        .terms-checkbox {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            width: 22px;
            height: 22px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            transition: all 0.3s;
        }

        .terms-checkbox:checked ~ .checkmark {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
            border-color: #14b8a6;
        }

        .checkmark::after {
            content: '';
            position: absolute;
            display: none;
            left: 6px;
            top: 2px;
            width: 6px;
            height: 12px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .terms-checkbox:checked ~ .checkmark::after {
            display: block;
            animation: checkAnim 0.2s ease;
        }

        @keyframes checkAnim {
            0% { transform: rotate(45deg) scale(0); }
            100% { transform: rotate(45deg) scale(1); }
        }

        .terms-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95rem;
        }

        .terms-label a {
            color: #14b8a6;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
        }

        .terms-label a:hover {
            color: #5eead4;
            text-shadow: 0 0 10px rgba(20, 184, 166, 0.5);
        }

        /* Next Button */
        .next-btn {
            width: 100%;
            padding: 18px 30px;
            background: linear-gradient(135deg, rgba(20, 184, 166, 0.2), rgba(13, 148, 136, 0.2));
            border: 1px solid rgba(20, 184, 166, 0.3);
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            font-family: 'Kanit', sans-serif;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .next-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .next-btn:hover:not(:disabled)::before {
            left: 100%;
        }

        .next-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
            border-color: #14b8a6;
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(20, 184, 166, 0.4);
        }

        .next-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            filter: grayscale(0.5);
        }

        .next-btn i {
            transition: transform 0.3s;
        }

        .next-btn:hover:not(:disabled) i {
            transform: translateX(5px);
        }

        /* Step 2: Input Form */
        .topup-form {
            display: none;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            max-width: 700px;
            margin: 0 auto;
            animation: formSlideIn 0.5s ease;
        }

        @keyframes formSlideIn {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .topup-form.active {
            display: block;
        }

        .form-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .back-btn-form {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .back-btn-form:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .form-title {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .form-title .white { color: white; }
        .form-title .red { color: #ef4444; }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            color: #14b8a6;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .input-label .required {
            color: #ef4444;
        }

        .input-field {
            width: 100%;
            padding: 14px 18px;
            padding-left: 45px;
            background: rgba(13, 17, 23, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #6b7280;
            font-size: 0.95rem;
            font-family: 'Kanit', sans-serif;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #14b8a6;
            color: white;
        }

        .input-field::placeholder {
            color: #4b5563;
        }

        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #ef4444;
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            background: white;
            border: none;
            border-radius: 8px;
            color: #0d1117;
            font-size: 1rem;
            font-weight: 600;
            font-family: 'Kanit', sans-serif;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
        }

        /* Coupon Form */
        .coupon-form .form-title .red {
            color: #8b5cf6;
        }

        .coupon-form .input-label {
            color: #8b5cf6;
        }

        .coupon-form .input-icon {
            color: #8b5cf6;
        }

        .coupon-form .input-field:focus {
            border-color: #8b5cf6;
        }

        /* QR Form */
        .qr-form .form-title .red {
            color: #3b82f6;
        }

        .qr-form .input-label {
            color: #3b82f6;
        }

        .qr-form .input-icon {
            color: #3b82f6;
        }

        .qr-form .input-field:focus {
            border-color: #3b82f6;
        }

        .input-suffix {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
            font-size: 0.9rem;
        }

        .amount-hint {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 8px;
        }

        .quick-amounts {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .quick-amount-btn {
            padding: 8px 16px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            color: #3b82f6;
            font-size: 0.9rem;
            font-family: 'Kanit', sans-serif;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-amount-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
        }

        .qr-display {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .qr-amount-display {
            font-size: 1.2rem;
            color: #fff;
            margin-bottom: 15px;
        }

        .qr-amount-display strong {
            color: #3b82f6;
            font-size: 1.5rem;
        }

        .qr-code-container {
            background: white;
            padding: 15px;
            border-radius: 12px;
            display: inline-block;
            margin: 15px 0;
        }

        .qr-code-container img {
            width: 200px;
            height: 200px;
        }

        .qr-instruction {
            color: #9ca3af;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .qr-ref {
            color: #6b7280;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .slip-upload-section {
            margin: 20px 0;
        }

        .slip-upload-section h4 {
            color: #fff;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .upload-area {
            border: 2px dashed rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }

        .upload-placeholder i {
            font-size: 2.5rem;
            color: #3b82f6;
            margin-bottom: 10px;
        }

        .upload-placeholder p {
            color: #9ca3af;
        }

        .btn-secondary {
            width: 100%;
            margin-top: 10px;
            padding: 12px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #9ca3af;
            font-size: 0.9rem;
            font-family: 'Kanit', sans-serif;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            border-color: rgba(255, 255, 255, 0.4);
            color: #fff;
        }

        /* Step 1 container */
        .step-1 {
            display: block;
        }

        .step-1.hidden {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .payment-options {
                grid-template-columns: 1fr;
            }

            .navbar {
                padding: 15px 20px;
            }

            .nav-links {
                display: none;
            }

            .topup-container {
                padding: 20px;
            }

            .page-title h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>

    <!-- Loading Screen (‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏î‡∏¢ JS ‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô) -->
    <div class="loading-screen" id="loadingScreen" style="display: none;">
        <div class="infinity-loader">
            <svg viewBox="0 0 100 50">
                <path d="M25,25 C25,10 10,10 10,25 C10,40 25,40 25,25 C25,10 40,10 50,25 C60,40 75,40 75,25 C75,10 90,10 90,25 C90,40 75,40 75,25 C75,10 60,10 50,25 C40,40 25,40 25,25" />
            </svg>
        </div>
        <div class="loading-logo">
            <span class="dips">DIPS</span><span class="hub">HUB</span>
        </div>
        <div class="loading-progress">
            <div class="loading-progress-bar"></div>
        </div>
    </div>
    <script>
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á loading ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        (function() {
            const navEntries = performance.getEntriesByType('navigation');
            const navType = navEntries.length > 0 ? navEntries[0].type : 'navigate';
            
            // ‡πÅ‡∏™‡∏î‡∏á loading ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô reload ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            if (navType === 'reload') {
                document.getElementById('loadingScreen').style.display = 'flex';
            }
        })();
    </script>

    <!-- Background -->
    <div class="bg-wrapper">
        <div class="bg-image"></div>
    </div>

    <!-- Navbar -->
    <nav class="navbar">
        <a href="/" class="nav-brand">
            <i class="fa-solid fa-gear fa-spin" style="color: #14b8a6; font-size: 1.3rem;"></i>
            <span><span class="dips">DIPS</span><span class="hub">HUB</span></span>
        </a>
        <div class="nav-links">
            <a href="/"><i class="fa-solid fa-house"></i> Home</a>
            <a href="/pages/store.html"><i class="fa-solid fa-store"></i> Store</a>
            <a href="/pages/topup.html" class="active"><i class="fa-regular fa-credit-card"></i> Topup</a>
            <a href="#"><i class="fa-solid fa-list"></i> Features</a>
            <a href="#"><i class="fa-solid fa-question"></i> How to</a>
            <a href="#"><i class="fa-regular fa-newspaper"></i> News</a>
        </div>
        <div class="user-profile">
            <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÇ‡∏î‡∏¢ auth.js -->
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="topup-container">
            
            <!-- Step 1: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
            <div class="step-1" id="step1">
                <div class="page-title">
                    <h1><span class="white">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á</span> <span class="red">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</span></h1>
                </div>

                <div class="payment-options">
                    <div class="payment-option" id="qrOption" onclick="selectPayment('qr')">
                        <div class="payment-icon qr">
                            <i class="fa-solid fa-qrcode"></i>
                        </div>
                        <div class="payment-info">
                            <h3>QR PromptPay</h3>
                            <p>‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏ú‡πà‡∏≤‡∏ô Mobile Banking</p>
                        </div>
                    </div>

                    <div class="payment-option" id="couponOption" onclick="selectPayment('coupon')">
                        <div class="payment-icon coupon">
                            üéÅ
                        </div>
                        <div class="payment-info">
                            <h3>‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</h3>
                            <p>‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</p>
                        </div>
                    </div>
                </div>

                <div class="terms-wrapper">
                    <label class="checkbox-custom">
                        <input type="checkbox" class="terms-checkbox" id="termsCheckbox" onchange="updateNextButton()">
                        <span class="checkmark"></span>
                    </label>
                    <span class="terms-label">
                        ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö <a href="#">‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</a>
                    </span>
                </div>

                <button class="next-btn" id="nextBtn" disabled onclick="goToStep2()">
                    <span>‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</span>
                    <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>

            <!-- Step 2: ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á -->
            <div class="topup-form coupon-form" id="couponForm">
                <div class="form-header">
                    <button class="back-btn-form" onclick="goBack()">
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                    <h2 class="form-title">
                        <span class="white">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô</span><span class="red">‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</span>
                    </h2>
                </div>

                <div class="input-group">
                    <label class="input-label">
                        ‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á<span class="required">*</span>
                    </label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-ticket input-icon"></i>
                        <input type="text" class="input-field" id="couponCode" placeholder="XXXX-XXXX-XXXX">
                    </div>
                </div>

                <button class="submit-btn" onclick="submitTopup('coupon')">
                    <i class="fa-solid fa-gift"></i>
                    <span>‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</span>
                </button>
            </div>

            <!-- Step 2: QR PromptPay Form -->
            <div class="topup-form qr-form" id="qrForm">
                <div class="form-header">
                    <button class="back-btn-form" onclick="goBack()">
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                    <h2 class="form-title">
                        <span class="white">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô</span><span class="red"> QR PromptPay</span>
                    </h2>
                </div>

                <!-- Step 2.1: ‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô -->
                <div id="qrStep1">
                    <div class="input-group">
                        <label class="input-label">
                            ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°<span class="required">*</span>
                        </label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-coins input-icon"></i>
                            <input type="number" class="input-field" id="qrAmount" placeholder="100" min="10" max="10000">
                            <span class="input-suffix">‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="amount-hint">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 10 ‡∏ö‡∏≤‡∏ó - ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10,000 ‡∏ö‡∏≤‡∏ó</div>
                    </div>

                    <div class="quick-amounts">
                        <button class="quick-amount-btn" onclick="setQrAmount(50)">50‡∏ø</button>
                        <button class="quick-amount-btn" onclick="setQrAmount(100)">100‡∏ø</button>
                        <button class="quick-amount-btn" onclick="setQrAmount(200)">200‡∏ø</button>
                        <button class="quick-amount-btn" onclick="setQrAmount(500)">500‡∏ø</button>
                        <button class="quick-amount-btn" onclick="setQrAmount(1000)">1,000‡∏ø</button>
                    </div>

                    <button class="submit-btn" onclick="generateQR()">
                        <i class="fa-solid fa-qrcode"></i>
                        <span>‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</span>
                    </button>
                </div>

                <!-- Step 2.2: ‡πÅ‡∏™‡∏î‡∏á QR Code -->
                <div id="qrStep2" style="display:none;">
                    <div class="qr-display">
                        <div class="qr-amount-display">
                            <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</span>
                            <strong id="displayAmount">0</strong> ‡∏ö‡∏≤‡∏ó
                        </div>
                        <div class="qr-code-container">
                            <img id="qrCodeImage" src="" alt="QR PromptPay">
                        </div>
                        <p class="qr-instruction">‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏ô‡∏µ‡πâ‡∏ú‡πà‡∏≤‡∏ô Mobile Banking ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</p>
                        <p class="qr-ref">Ref: <span id="qrRef">-</span></p>
                    </div>

                    <div class="slip-upload-section">
                        <h4>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</h4>
                        <div class="upload-area" id="uploadArea" onclick="document.getElementById('slipFile').click()">
                            <input type="file" id="slipFile" accept="image/*" style="display:none" onchange="previewSlip(this)">
                            <div class="upload-placeholder" id="uploadPlaceholder">
                                <i class="fa-solid fa-cloud-arrow-up"></i>
                                <p>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ</p>
                            </div>
                            <img id="slipPreview" src="" alt="Preview" style="display:none;max-height:200px;border-radius:8px;">
                        </div>
                    </div>

                    <button class="submit-btn" onclick="submitSlip()">
                        <i class="fa-solid fa-paper-plane"></i>
                        <span>‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</span>
                    </button>

                    <button class="btn-secondary" onclick="resetQrForm()">
                        <i class="fa-solid fa-refresh"></i>
                        ‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡πÉ‡∏´‡∏°‡πà
                    </button>
                </div>
            </div>

        </div>
    </main>

    <script src="/js/auth.js"></script>
    <script>
        let selectedPayment = null;
        let currentQrAmount = 0;
        let currentQrRef = '';
        let slipBase64 = null;

        function selectPayment(type) {
            selectedPayment = type;
            
            // Remove selected from all
            document.querySelectorAll('.payment-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Add selected to clicked
            const optionId = type === 'qr' ? 'qrOption' : (type === 'angpao' ? 'angpaoOption' : 'couponOption');
            const optionEl = document.getElementById(optionId);
            if (optionEl) {
                optionEl.classList.add('selected');
            }
            
            updateNextButton();
        }

        function updateNextButton() {
            const termsChecked = document.getElementById('termsCheckbox').checked;
            const nextBtn = document.getElementById('nextBtn');
            
            if (selectedPayment && termsChecked) {
                nextBtn.disabled = false;
            } else {
                nextBtn.disabled = true;
            }
        }

        function goToStep2() {
            document.getElementById('step1').classList.add('hidden');
            
            if (selectedPayment === 'qr') {
                document.getElementById('qrForm').classList.add('active');
            } else if (selectedPayment === 'angpao') {
                document.getElementById('angpaoForm')?.classList.add('active');
            } else {
                document.getElementById('couponForm').classList.add('active');
            }
        }

        function goBack() {
            document.getElementById('step1').classList.remove('hidden');
            document.getElementById('qrForm')?.classList.remove('active');
            document.getElementById('angpaoForm')?.classList.remove('active');
            document.getElementById('couponForm')?.classList.remove('active');
            resetQrForm();
        }

        // QR PromptPay Functions
        function setQrAmount(amount) {
            document.getElementById('qrAmount').value = amount;
        }

        async function generateQR() {
            const amount = parseFloat(document.getElementById('qrAmount').value);
            
            if (!amount || amount < 10 || amount > 10000) {
                showWarning('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 10 - 10,000 ‡∏ö‡∏≤‡∏ó');
                return;
            }

            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code...',
                allowOutsideClick: false,
                didOpen: () => Swal.showLoading()
            });

            try {
                const res = await fetch('/api/thunder/generate-qr', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ amount })
                });
                const data = await res.json();
                
                Swal.close();

                if (data.success) {
                    currentQrAmount = data.amount;
                    currentQrRef = data.ref;
                    
                    document.getElementById('displayAmount').textContent = data.amount.toLocaleString();
                    document.getElementById('qrRef').textContent = data.ref;
                    
                    // ‡πÅ‡∏™‡∏î‡∏á QR Code
                    const qrImg = document.getElementById('qrCodeImage');
                    if (data.qrImage) {
                        qrImg.src = data.qrImage;
                    } else if (data.qrCode) {
                        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ QR string ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏ú‡πà‡∏≤‡∏ô QR API
                        qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(data.qrCode)}`;
                    }

                    document.getElementById('qrStep1').style.display = 'none';
                    document.getElementById('qrStep2').style.display = 'block';
                } else {
                    showError(data.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡πÑ‡∏î‡πâ');
                }
            } catch (error) {
                Swal.close();
                console.error('Generate QR error:', error);
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
            }
        }

        function previewSlip(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    slipBase64 = e.target.result;
                    document.getElementById('slipPreview').src = slipBase64;
                    document.getElementById('slipPreview').style.display = 'block';
                    document.getElementById('uploadPlaceholder').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        async function submitSlip() {
            if (!slipBase64) {
                showWarning('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏•‡∏¥‡∏õ...',
                allowOutsideClick: false,
                didOpen: () => Swal.showLoading()
            });

            try {
                const res = await fetch('/api/thunder/verify-slip', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({
                        slipData: slipBase64,
                        amount: currentQrAmount
                    })
                });
                const data = await res.json();
                
                Swal.close();

                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        html: `
                            <div style="text-align:left;padding:10px;">
                                <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</strong> ${data.amount?.toLocaleString() || currentQrAmount} ‡∏ö‡∏≤‡∏ó</p>
                                <p><strong>Ref:</strong> ${data.transRef || '-'}</p>
                                <p style="font-size:12px;color:#888;margin-top:10px;">
                                    ‡∏£‡∏≠ Admin ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì
                                </p>
                            </div>
                        `,
                        confirmButtonColor: '#3b82f6'
                    }).then(() => {
                        goBack();
                    });
                } else {
                    showError(data.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏î‡πâ');
                }
            } catch (error) {
                Swal.close();
                console.error('Submit slip error:', error);
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
            }
        }

        function resetQrForm() {
            currentQrAmount = 0;
            currentQrRef = '';
            slipBase64 = null;
            document.getElementById('qrAmount').value = '';
            document.getElementById('qrStep1').style.display = 'block';
            document.getElementById('qrStep2').style.display = 'none';
            document.getElementById('slipPreview').style.display = 'none';
            document.getElementById('uploadPlaceholder').style.display = 'block';
            document.getElementById('slipFile').value = '';
        }

        function submitTopup(type) {
            if (type === 'angpao') {
                const link = document.getElementById('angpaoLink')?.value?.trim();
                if (!link) {
                    showWarning('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏•‡∏¥‡πâ‡∏á‡∏ã‡∏≠‡∏á‡∏≠‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏≤');
                    return;
                }
                
                // Validate format
                if (!link.includes('gift.truemoney.com') && !/^[a-zA-Z0-9]{8,}$/.test(link)) {
                    showWarning('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏•‡∏¥‡πâ‡∏á‡∏ã‡∏≠‡∏á‡∏≠‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    return;
                }
                
                // Show loading
                Swal.fire({
                    title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠...',
                    html: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });
                
                // Call Manual Angpao API
                fetch('/api/angpao/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ voucherLink: link })
                })
                .then(response => response.json())
                .then(data => {
                    Swal.close();
                    
                    if (data.success) {
                        Swal.fire({
                            icon: 'success',
                            title: '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                            html: `
                                <div style="text-align: left; padding: 10px;">
                                    <p><strong>‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≥‡∏Ç‡∏≠:</strong> ${data.request.id}</p>
                                    <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ‡∏£‡∏≠ Admin ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                                    <p style="font-size: 12px; color: #888; margin-top: 10px;">
                                        Admin ‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏ã‡∏≠‡∏á‡∏≠‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì<br>
                                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Transactions
                                    </p>
                                </div>
                            `,
                            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                            confirmButtonColor: '#8B5CF6'
                        }).then(() => {
                            // Clear input
                            document.getElementById('angpaoLink').value = '';
                            // Go back to step 1
                            goBack();
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: '‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                            text: data.error || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                            confirmButtonColor: '#8B5CF6'
                        });
                    }
                })
                .catch(error => {
                    console.error('Angpao submit error:', error);
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                        confirmButtonColor: '#8B5CF6'
                    });
                });
                
            } else {
                const code = document.getElementById('couponCode').value.trim();
                if (!code) {
                    showWarning('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á');
                    return;
                }
                // TODO: Coupon API (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)
                Swal.fire({
                    icon: 'info',
                    title: '‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á',
                    text: '‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    confirmButtonColor: '#8B5CF6'
                });
            }
        }

        // Hide loading screen
        window.addEventListener('load', function() {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen && loadingScreen.style.display !== 'none') {
                setTimeout(function() {
                    loadingScreen.classList.add('hide');
                    setTimeout(function() {
                        loadingScreen.remove();
                    }, 500);
                }, 1500);
            } else if (loadingScreen) {
                loadingScreen.remove();
            }
            
            // Check Thunder API status
            checkThunderStatus();
        });
        
        // Check Thunder API system status
        let thunderEnabled = false;
        let hasPromptPayId = false;
        
        async function checkThunderStatus() {
            try {
                const response = await fetch('/api/thunder/config');
                const data = await response.json();
                
                thunderEnabled = data.enabled;
                hasPromptPayId = data.hasPromptPayId;
                
                const qrOption = document.getElementById('qrOption');
                if (!qrOption) return;
                
                const info = qrOption.querySelector('.payment-info p');
                
                if (!data.enabled) {
                    // Add disabled badge
                    const badge = document.createElement('span');
                    badge.className = 'status-badge disabled';
                    badge.textContent = '‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á';
                    badge.style.cssText = 'position: absolute; top: 8px; right: 8px; background: #ef4444; color: white; font-size: 10px; padding: 2px 8px; border-radius: 10px;';
                    qrOption.style.position = 'relative';
                    qrOption.appendChild(badge);
                } else if (!data.hasPromptPayId) {
                    // PromptPay not configured
                    const badge = document.createElement('span');
                    badge.className = 'status-badge disabled';
                    badge.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°';
                    badge.style.cssText = 'position: absolute; top: 8px; right: 8px; background: #f59e0b; color: white; font-size: 10px; padding: 2px 8px; border-radius: 10px;';
                    qrOption.style.position = 'relative';
                    qrOption.appendChild(badge);
                    if (info) {
                        info.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà';
                    }
                } else {
                    // Show limits
                    if (info) {
                        info.textContent = `‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ ${data.minAmount?.toLocaleString() || 10}-${data.maxAmount?.toLocaleString() || 10000} ‡∏ö‡∏≤‡∏ó`;
                    }
                }
            } catch (error) {
                console.error('Failed to check Thunder status:', error);
            }
        }
        
        // Override selectPayment to check status
        const originalSelectPayment = selectPayment;
        selectPayment = function(type) {
            if (type === 'qr' && !thunderEnabled) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á',
                    text: '‡∏£‡∏∞‡∏ö‡∏ö QR PromptPay ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            if (type === 'qr' && !hasPromptPayId) {
                Swal.fire({
                    icon: 'info',
                    title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö',
                    text: '‡∏£‡∏∞‡∏ö‡∏ö QR PromptPay ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Admin',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }
            originalSelectPayment(type);
        };
    </script>
    <script src="../js/sweetalert-config.js"></script>
</body>
</html>